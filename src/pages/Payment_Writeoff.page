<apex:page controller="PaymentWizardController" tabStyle="Opportunity" action="{!PaymentWriteoffWizard}">
<!--
Opp Payment Creator VF Page
Copyright (c) 2008 Evan Callahan, evanc@npowerseattle.org, NPower Seattle, 403 23rd Ave S, Seattle, WA 98144
-->
   <script>
        //hack to override JavaScript that is setting focus on Date field 
        function setFocusOnLoad() {} 
    </script>
    <apex:outputPanel rendered="{!AND(NOT(ISNULL(PaymentsSettings)), PaymentsSettings.Payments_Enabled__c == false)}">
    <apex:pageBlock title="NPSP Payments Not Enabled">You do not have NPSP Payments Enabled.  To use the Payment Writeoff Wizard, please enable Payments on the Settings page.&nbsp;<apex:outputLink value="/apex/PaymentsSettings">Payments Settings</apex:outputLink></apex:pageBlock>
    </apex:outputPanel>
    <apex:outputPanel rendered="{!AND(NOT(ISNULL(PaymentsSettings)), PaymentsSettings.Payments_Enabled__c == true)}">
    <apex:sectionHeader title="Payments" subtitle="Writeoff Remaining Balance"/>
    <apex:pageBlock title="Current Opportunity Info">
        <apex:pageBlockSection id="theGrid" columns="2" rendered="{!NOT(ISNULL(currentOpp))}">       
            <apex:outputField value="{!currentOpp.Name}" />
            <apex:outputField value="{!currentOpp.Amount}" />
            <apex:outputField value="{!currentOpp.StageName}" />
            <apex:outputField value="{!currentOpp.Payments_Made__c}" />
            <apex:outputField value="{!currentOpp.CloseDate}" />
         	<apex:outputField value="{!currentOpp.Amount_Outstanding__c}" />
       </apex:pageBlockSection>
       <apex:outputText value="No opportunity found."  rendered="{!ISNULL(CurrentOpp)}"/>
    </apex:pageBlock>
    <apex:form >
    <apex:outputPanel rendered="{!AND(NOT(ISNULL(CurrentOpp)), NOT(haveAmount), NOT(ISNULL(PaymentsSettings)), PaymentsSettings.Payments_Enabled__c == true)}">
    NOTE: This opportunity has no unpaid amount. To writeoff payments, 
    first&nbsp;<apex:outputLink value="{!'/' + currentOpp.id}">edit the opportunity record</apex:outputLink> and 
    enter an amount or delete existing payments.
    </apex:outputPanel>
    <apex:pageBlock title="Writeoff Payments" rendered="{!AND(NOT(ISNULL(CurrentOpp)), haveAmount, NOT(ISNULL(PaymentsSettings)), PaymentsSettings.Payments_Enabled__c == true)}">
        <apex:pageBlockButtons >
        <apex:commandButton action="{!writeoff}" value="Writeoff Payments"/>
        </apex:pageBlockButtons>
        <apex:OutputPanel >
        You are preparing to writeoff&nbsp;
        	<apex:outputField value="{!currentOpp.Number_of_Payments__c}" />
       	Payment(s) totaling&nbsp;
        	<apex:outputField value="{!currentOpp.Amount_Outstanding__c}" />
       	.<br /><br/>
        Which date would you like to use?&nbsp;<apex:inputField value="{!writeoffPayment.Payment_Date__c}" />
        </apex:OutputPanel>
    </apex:pageBlock>
    </apex:form>

    
    </apex:outputPanel>
</apex:page>